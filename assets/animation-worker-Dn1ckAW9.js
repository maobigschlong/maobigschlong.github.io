(function(){"use strict";let s=[],r,u,h=null,f,x,d=!1,p=!1;const g=.1;onmessage=m=>{if(p)return;const{type:l,...a}=m.data;if(l==="init")s=a.iconData.map(t=>({...t,lastX:t.x,lastY:t.y,currentX:t.x,currentY:t.y})),r=a.gameWidth,u=a.gameHeight,f=a.movementThreshold,x=a.useInterpolation;else if(l==="animate"&&!d)X(a.time);else if(l==="pause"){const t=d;d=a.paused,!d&&t&&(h=null,s=s.map(e=>({...e,currentX:e.x,currentY:e.y,lastX:e.x,lastY:e.y})),postMessage({type:"update",positions:s.map(e=>({x:e.x,y:e.y}))}))}},onmessageerror=()=>p=!0;function X(m){if(d)return;if(h===null){h=m;return}const l=.1;let a=(m-h)/1e3;a>l&&(a=l),s=s.map(t=>{(t.x<=0||t.x>=r-t.width)&&(t.dx*=-1,t.x<=0?t.x=1:t.x>=r-t.width&&(t.x=r-t.width-1)),(t.y<=0||t.y>=u-t.height)&&(t.dy*=-1,t.y<=0?t.y=1:t.y>=u-t.height&&(t.y=u-t.height-1));let e=t.x+t.dx*a,y=t.y+t.dy*a;return e=Math.max(0,Math.min(e,r-t.width)),y=Math.max(0,Math.min(y,u-t.height)),t.x=e,t.y=y,(Math.abs(e-t.lastX)>f||Math.abs(y-t.lastY)>f)&&(t.lastX=e,t.lastY=y),x?(t.currentX+=(t.lastX-t.currentX)*g,t.currentY+=(t.lastY-t.currentY)*g):(t.currentX=t.lastX,t.currentY=t.lastY),t}),h=m,postMessage({type:"update",positions:s.map(t=>({x:t.currentX,y:t.currentY}))})}})();
